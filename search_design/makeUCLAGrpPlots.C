root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m600_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m600_0.root",1,193272)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m800_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m800_0.root",1,199720)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1000_0.root",1,199260)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1200_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1200_0.root",1,188317)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1400_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1400_0.root",1,195599)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1600_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1600_0.root",1,194450)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1800_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1800_0.root",1,191860)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m2000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m2000_0.root",1,199661)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m2500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m2500_0.root",1,195138)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m3000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m3000_0.root",1,193422)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m3500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m3500_0.root",1,189668)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m4000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m4000_0.root",1,197003)' &
root -l -b -q 'TreeAnalyzer/search_design/getCutflow.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m4500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m4500_0.root",1,174582)' &
  
  
  
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m600_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m600_0.root",1,193272)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m800_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m800_0.root",1,199720)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1000_0.root",1,199260)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1200_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1200_0.root",1,188317)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1400_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1400_0.root",1,195599)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1600_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1600_0.root",1,194450)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m1800_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m1800_0.root",1,191860)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m2000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m2000_0.root",1,199661)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m2500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m2500_0.root",1,195138)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m3000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m3000_0.root",1,193422)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m3500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m3500_0.root",1,189668)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m4000_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m4000_0.root",1,197003)' &
  root -l -b -q 'TreeAnalyzer/search_design/getLeptonSelection.C+("/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/jobs/sd_getCutflow/files_radion_hh_bbinc_m4500_0.txt",2,"/uscms_data/d3/nmccoll/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/plots/out_radion_hh_bbinc_m4500_0.root",1,174582)' &



  //Lepoton plot
{
  TFile * f = new TFile("getCutflow.root");
  Plotter * p = new Plotter();
  
  TH1 * ht_d = 0; f->GetObject("signal_incl_mass",ht_d);
  TH1 * ht_n = 0; f->GetObject("signal_ht_mass",ht_n);
  ht_n->Divide(ht_d);
  p->addHist(ht_n,"(#it{H}_{T} > 500 GeV) / inclusive",-1,1,4,20,1,true,false);
  
  TH1 * e_d = 0; f->GetObject("signal_e_incl_mass",e_d);
  TH1 * e_n = 0; f->GetObject("signal_e_iso_mass",e_n);
  e_n->Divide(e_d);
  p->addHist(e_n,"(selected e) / (inclusive WW*#rightarrowe#nu)",-1,1,4,20,1,true,false);
  
  TH1 * mu_d = 0; f->GetObject("signal_mu_incl_mass",mu_d);
  TH1 * mu_n = 0; f->GetObject("signal_mu_iso_mass",mu_n);
  mu_n->Divide(mu_d);
  p->addHist(mu_n,"(selected #mu) / (inclusive WW*#rightarrow#mu#nu)",-1,1,4,20,1,true,false);
  // TH1* addHist(const TH1 * hist, TString title, int lineColor = -1, int lineStyle = 1, int lineWidth = 4, int markerStyle = 20, int markerSize = 1,  bool drawMarker = true, bool drawErrorBars = true,bool poissonErrors = false, TString drawOption = "");
  
  
  p->setYTitle("efficiency");
  p->draw();
  
  
  
}




rr -b -q '~/GitRepositories/TreeAnalyzer/control_regions/drawVariables.C+("../../testTrees/out_radion_hh_bbinc_m1000_0.root",1,"vars_m1000.root")'
  rr -b -q '~/GitRepositories/TreeAnalyzer/control_regions/drawVariables.C+("../../testTrees/out_t-tbar1l-madgraph_18.root",1,"vars_ttbar.root")'

{
  Plotter * p = new Plotter();
  p->addHistLine(m1000_wjj_mass,"h");
  p->normalize();
  p->draw();
}


//Plot variables
{
  TFile * f = new TFile("drawVars.root");
  // std::vector<TString> smps = {"ttbar","wjets","m1000"};
  // std::vector<TString> smpNs = {"t#bar{t}","W+jets","#it{m}(X) = 1 TeV"};
  std::vector<TString> smps = {"qcd","m1000"};
  std::vector<TString> smpNs = {"QCD","#it{m}(X) = 1 TeV"};
  // std::vector<TString> vars = {"wjj_mass","wjj_tau","wlnu_mass","hww_mass"};
  // std::vector<TString> vars = {"mnd","hh_mass","hbb_mass"};
    std::vector<TString> vars = {"loose_wlnudr"};
  
  for(const auto& v : vars ){
    Plotter * p = new Plotter();
    for(unsigned int iS = 0; iS < smps.size(); ++iS){
      TH1 * h = 0; 
      f->GetObject(TString::Format("%s_%s",smps[iS].Data(),v.Data()),h);
      if(h == 0) continue;
      if(iS +1 == smps.size())
        p->addStackHist(h,smpNs[iS]);
      else
              p->addHist(h,smpNs[iS]);
              
    }
    p->normalize();
    // p->rebin(10);
    auto *c = p->draw(false,v);
    auto * a = p->yAxis();
    a->SetTitleOffset(1.5);
    c->Update();
    
  }
  
}


//Do Categories
{
  TH2 * h = signal_mass_hbbCat;
  
  for(unsigned int iX = 1; iX <= h->GetNbinsX(); ++iX){
    float tot = h->Integral(iX,iX,0,-1);
    if(tot == 0) continue;
    for(unsigned int iY = 1; iY <= h->GetNbinsY(); ++iY){
      h->SetBinContent(iX,iY,h->GetBinContent(iX,iY)/tot);    
    } 
  }
  
  auto * yax = h->GetYaxis();
  yax->SetBinLabel(1,"none");
  yax->SetBinLabel(2,"1 L");
  yax->SetBinLabel(3,"2 L");
  yax->SetBinLabel(4,"1 M");
  yax->SetBinLabel(5,"1 M, 1 L");
  yax->SetBinLabel(6,"2 M");
  h->Draw("COLZ");
}


//Signal eff
{
  TFile * f = new TFile("drawVars.root");
  
vector<unsigned int> fullSigMasses = {
  600,
  800,
  1000,
  1200,
  1400,
  1600,
  1800,
  2000,
  2500,
  3000,
  3500,
  4000,
  4500
};

  auto effPlots = [&](TString name, std::vector<unsigned int>& cuts, std::vector<TString>& cutNames){
      std::vector<TH1*> hists;
      for(unsigned int iN = 0; iN < cuts.size(); ++iN){
        hists.push_back(new TH1F(TString::Format("%s_%u",name.Data(),iN),";#it{m}(X) [TeV]",40,0.550,4.550));
      }

      for(auto m : fullSigMasses){
        TH1 * h = 0;
        f->GetObject(TString::Format("m%u_signal_evtCounts",m),h);
        if(h==0){std:: cout <<TString::Format("m%u_signal_evtCounts",m)<<std::endl; continue;}
        for(unsigned int iC = 0; iC < cuts.size(); ++iC){
          hists[iC]->SetBinContent(hists[iC]->FindFixBin(float(m)/1000.),h->GetBinContent(cuts[iC]+1));
        }
      }
      Plotter * p = new Plotter;
      for(unsigned int iN = 0; iN < cuts.size(); ++iN){
        // hists[iN]->Scale(26.18/1000.);
        p->addHist(hists[iN],cutNames[cuts[iN]],-1,1,4,20,1,true,false);
      }
      p->setMinMax(0,1.0);
      p->drawRatio(false,"stack",false,false,name);

            // p->draw(false,name);
};
// std::vector<unsigned int> cuts = {0,1,2,3,4,5,6};
// std::vector<TString> cutNs = {"all e/#mu events","trigger preselection","+ Wjj sel.","+ Hbb (LMT b-tagging) sel.","+ #it{m}_{ND}","+ #DeltaR[l,#nu]","+ anti AK4 b-tag" };

// std::vector<unsigned int> cuts = {0,6,5,4,3,2,1};
std::vector<unsigned int> cuts = {0,9,8,7};
std::vector<TString> cutNs = {"all e/#mu events","trigger preselection","+ Wjj sel.","+ Hbb (LMT b-tagging) sel.","+ #it{m}_{ND}","+ #DeltaR[l,#nu]","+ anti AK4 b-tag", "Loose b-tag cat.", "Medium b-tag cat.", "Tight b-tag cat." };


effPlots("yep",cuts,cutNs);


}

// BKG counts
{
// std::vector<TString> cutNs = {"+ anti AK4 b-tag","+ #DeltaR[l,#nu]","+ #it{m}_{ND}","+ Hbb (LMT b-tagging) sel.","+ Wjj sel.","+ 2nd lepton veto","trigger preselection"};
// std::vector<TString> cuts = {"abtag","wlnu","mnd","hbb","wjj","lepVeto","trigger"};

std::vector<TString> cutNs = {"Loose b-tag cat.", "Medium b-tag cat.", "Tight b-tag cat."};
std::vector<TString> cuts = {"L","M","T"};

Plotter * p = new Plotter;
TFile * f = new TFile("drawVars.root");

for(unsigned int iN = 0; iN < cuts.size(); ++iN){
  TH1 * h = 0;
  f->GetObject(TString::Format("bkg_%s_evtCounts",cuts[iN].Data()),h);
  if(h == 0) continue;
  p->addHistLine(h,cutNs[iN]);
}

p->setYTitle("N. of events");
p->setXTitle(" ");

auto * c = p->draw();
auto * yax = p->xAxis();
yax->SetBinLabel(1,"t#bar{t}");
yax->SetBinLabel(2,"W+jets");
yax->SetBinLabel(3,"Z+jets");
yax->SetBinLabel(4,"t");
yax->SetBinLabel(5,"VV");
yax->SetBinLabel(6,"t#bar{t}X");
yax->SetBinLabel(7,"QCD");
c->Update();
}


//control regions
{
  TFile * f = new TFile("drawVars.root");
  // std::vector<TString> smps = {"ttbar","wjets","m1000"};
  // std::vector<TString> smpNs = {"t#bar{t}","W+jets","#it{m}(X) = 1 TeV"};
  std::vector<TString> smps = {"nres","res"};
  std::vector<TString> smpNs = {"non-resonant","resonant"};
    std::vector<TString> vars = {"wJJ_hh_mass","wJJ_hbb_mass","LI_hh_mass","LI_hbb_mass"};
  
  for(const auto& v : vars ){
    Plotter * p = new Plotter();
    for(unsigned int iS = 0; iS < smps.size(); ++iS){
      TH1 * h = 0; 
      f->GetObject(TString::Format("%s_%s",smps[iS].Data(),v.Data()),h);
      if(h == 0) continue;
              p->addStackHist(h,smpNs[iS]);
              
    }
    // p->normalize();
    // p->rebin(10);
    p->setYTitle("events / bin width");
if(v ==  "wJJ_hh_mass" || v == "LI_hh_mass")    p->rebin(10);
    auto *c = p->draw(false,v);
    auto * a = p->yAxis();
    a->SetTitleOffset(1.5);
    c->Update();
    
  }
  
}
